#!/usr/bin/env bash

# Terminal bell script for AI CLI app notifications
# Plays sound if terminal is active, shows notification otherwise

# Check if terminal has focus (macOS specific)
terminal_has_focus() {
    # Get the frontmost application
    FRONTMOST_APP=$(osascript -e 'tell application "System Events" to get name of first application process whose frontmost is true' 2>/dev/null)

    # Common terminal applications
    case "$FRONTMOST_APP" in
        "Terminal"|"iTerm2"|"iTerm"|"Alacritty"|"kitty"|"WezTerm"|"Hyper")
            return 0  # Terminal has focus
            ;;
        *)
            return 1  # Terminal doesn't have focus
            ;;
    esac
}

# Exit without notification if in Vim/Neovim via ACP
if [ -n "$VIMRUNTIME" ] || [ -n "$NVIM_LISTEN_ADDRESS" ]; then
    exit 0
fi

# Main logic

if terminal_has_focus; then
    # Terminal is active - just play the sound
    afplay /System/Library/Sounds/Tink.aiff &
else
    # Terminal is not active - show notification with sound
    terminal-notifier -title "$1" -message "Input needed" -sound Tink
fi

